<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- mapper interface랑 경로를 똑같이 정함 -->
<mapper namespace="com.ssd.petMate.dao.mybatis.mapper.SecondhandMapper">

    <!-- 중고물품 게시글 목록 가져오기  -->
	<select id="getSecondhandList" parameterType="com.ssd.petMate.page.BoardSearch" resultType="com.ssd.petMate.domain.Secondhand">
     	SELECT *
		FROM (
		SELECT secondhand.*, ROWNUM AS NUM
		FROM Secondhand
     	<where>
			<if test="searchType=='boardTitle' and keyword != null">
				and boardTitle LIKE CONCAT('%',#{keyword},'%')
			</if>
			<if test="searchType=='boardContent' and keyword != null">
				and boardContent LIKE CONCAT('%',#{keyword},'%')
			</if>
			<if test="searchType=='userID' and keyword != null">
				and userID LIKE CONCAT('%',#{keyword},'%')
			</if>
		</where>
     	ORDER BY boardNum) secondhand
		WHERE NUM BETWEEN #{startList} AND #{contentNum}
	</select>
	
	<!-- 중고물품 게시글 수 -->
	<select id="getSecondhandboardCount" resultType="int" parameterType="HashMap">
		SELECT COUNT(*)
		FROM Secondhand
		<where>
			<if test="searchType=='boardTitle' and keyword != null and keyword != ''">
				and boardTitle LIKE CONCAT('%',#{keyword},'%')
			</if>
			<if test="searchType=='boardContent' and keyword != null and keyword != ''">
				and boardContent LIKE CONCAT('%',#{keyword},'%')
			</if>
			<if test="searchType=='userID' and keyword != null and keyword != ''">
				and userID LIKE CONCAT('%',#{keyword},'%')
			</if>
		</where>
	</select>
	
	<!-- 중고물품 게시글 삽입하기  -->
	<insert id="insertSecondhand" parameterType="com.ssd.petMate.domain.Secondhand">
 		INSERT
 		INTO Secondhand(userID, boardTitle, boardContent, replyCnt, boardHit, boardDate, boardImage, price, cartAdded)
 		VALUES(#{userID}, #{boardTitle}, #{boardContent}, #{replyCnt, jdbcType=NUMERIC}, #{boardHit, jdbcType=NUMERIC}, SYSDATE, #{boardImage, jdbcType=VARCHAR}, #{price, jdbcType=NUMERIC}, #{cartAdded, jdbcType=NUMERIC})
 	</insert>
	
	<!-- 중고물품 게시글 수정하기  -->
	<update id="updateSecondhand" parameterType="com.ssd.petMate.domain.Secondhand">
		UPDATE Secondhand
		SET boardTitle = #{boardTitle}, boardContent = #{boardContent}, boardDate = SYSDATE, boardImage = #{boardImage,jdbcType=VARCHAR}, price = #{price}
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 중고물품 게시글 삭제하기  -->
	<delete id="deleteSecondhand" parameterType="int">
		DELETE FROM Secondhand
		WHERE boardNum = #{boardNum}
	</delete>

	<!-- 중고물품 게시글 상세정보 가져오기  -->
	<select id="getSecondhandDetail" parameterType="int" resultType="com.ssd.petMate.domain.Secondhand">
		SELECT *
		FROM Secondhand
		WHERE boardNum = #{boardNum}
	</select>
	
	<!-- 중고물품 장바구니 추가(장바구니 수 증가) -->
	<update id="secondhandCartPlus" parameterType="int">
		UPDATE Secondhand
		SET cartAdded = cartAdded + 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 중고물품 장바구니 삭제(장바구니 수 감소) -->
	<update id="secondhandCartMinus" parameterType="int">
		UPDATE Secondhand
		SET cartAdded = cartAdded - 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 중고물품 댓글 추가 -->
	<update id="secondhandReplyCntPlus" parameterType="int">
		UPDATE Secondhand
		SET replyCnt = replyCnt + 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 중고물품 댓글 삭제-->
	<update id="secondhandReplyCntMinus" parameterType="int">
		UPDATE Secondhand
		SET replyCnt = replyCnt - 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 중고물품 조회수 증가 -->
	<update id="secondhandBoardHitPlus" parameterType="int">
		UPDATE Secondhand
		SET boardHit = boardHit + 1
		WHERE boardNum = #{boardNum}
	</update>
	
</mapper>