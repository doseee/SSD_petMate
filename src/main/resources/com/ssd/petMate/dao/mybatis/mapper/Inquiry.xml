<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssd.petMate.dao.mybatis.mapper.InquiryMapper">
	<!-- 게시글 개수 가져오기 -->
	<select id="boardPageCount" resultType="int" parameterType="HashMap">
	      SELECT COUNT(*)
	      FROM Inquiry
	      <where>
	         <if test="searchType=='boardTitle' and keyword != null and keyword != ''">
	            and boardTitle LIKE CONCAT('%',#{keyword},'%')
	         </if>
	         <if test="searchType=='boardContent' and keyword != null and keyword != ''">
	            and boardContent LIKE CONCAT('%',#{keyword},'%')
	         </if>
	         <if test="searchType=='userID' and keyword != null and keyword != ''">
	            and userID LIKE CONCAT('%',#{keyword},'%')
	         </if>
	      </where>
	   </select>
	
	<!-- 게시글 목록 가져오기 -->
	<select id="getAllBoard" parameterType="com.ssd.petMate.page.BoardSearch" resultType="java.util.List">
      SELECT *
      FROM Inquiry
      <where>
         <if test="searchType=='boardTitle' and keyword != null">
            and boardTitle LIKE CONCAT('%',#{keyword},'%')
         </if>
         <if test="searchType=='boardContent' and keyword != null">
            and boardContent LIKE CONCAT('%',#{keyword},'%')
         </if>
         <if test="searchType=='userID' and keyword != null">
            and userID LIKE CONCAT('%',#{keyword},'%')
         </if>
      </where>
      ORDER BY boardNum
      LIMIT #{startList}, #{contentNum}
	</select>
	
	<!-- 게시글 작성 -->
	<insert id="insertBoard" parameterType="com.ssd.petMate.domain.Inquiry">
		INSERT
		INTO Inquiry(userID, boardTitle, boardContent, answerCnt, boardHit,
		boardDate, boardLike, boardImage, isSelected)
		VALUES(#{userID}, #{boardTitle}, #{boardContent}, #{answerCnt}, #{boardHit}, SYSDATE, #{boardLike}, #{boardImage}, #{isSelected})
	</insert>
	
	<!-- 게시글 상세보기 -->
	<select id="boardDetail" parameterType="int" resultType="com.ssd.petMate.domain.Inquiry">
		SELECT *
		FROM Inquiry
		WHERE boardNum = #{boardNum}
	</select>
	
	<!-- 게시글 수정 -->
	<update id="updateBoard" parameterType="com.ssd.petMate.domain.Inquiry">
		UPDATE Inquiry SET
		boardTitle = #{boardTitle},
		boardContent = #{boardContent},
		boardImage = #{boardImage},
		date = TO_DATE(SYSDATE,'yyyy.mm.dd hh24:mi')
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 게시글 삭제 -->
	<delete id="deleteBoard" parameterType="int">
		DELETE FROM Inquiry
		WHERE boardNum = #{boardNum}
	</delete>
	
	<!-- 답글 수 증가 -->
	<update id="plusReplyCnt" parameterType="int">
		UPDATE Inquiry
		SET answerCnt = answerCnt + 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 답글 수 감소 -->
	<update id="minusReplyCnt" parameterType="int">
		UPDATE Inquiry
		SET answerCnt = answerCnt - 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 조회수 증가 -->
	<update id="boardViews" parameterType="int">
		UPDATE Inquiry
		SET boardHit = boardHit + 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 좋아요 수 증가 -->
	<update id="plusLike" parameterType="int">
		UPDATE Inquiry
		SET boardLike = boardLike + 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 좋아요 수 감소 -->
	<update id="minusLike" parameterType="int">
		UPDATE Inquiry
		SET boardLike = boardLike - 1
		WHERE boardNum = #{boardNum}
	</update>
	
	<!-- 마감 -->
	<update id="select" parameterType="boolean">
		UPDATE Inquiry
		SET isSelected = TRUE;
		WHERE boardNum = #{boardNum}
	</update>
	
</mapper>